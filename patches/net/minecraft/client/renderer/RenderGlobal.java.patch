--- a/net/minecraft/client/renderer/RenderGlobal.java
+++ b/net/minecraft/client/renderer/RenderGlobal.java
@@ -1,21 +1,27 @@
 package net.minecraft.client.renderer;
 
-import com.google.common.collect.Iterators;
 import com.google.common.collect.Lists;
 import com.google.common.collect.Maps;
 import com.google.common.collect.Sets;
 import com.google.gson.JsonSyntaxException;
 import java.io.IOException;
+import java.util.ArrayDeque;
+import java.util.ArrayList;
+import java.util.Arrays;
 import java.util.Collection;
+import java.util.Collections;
+import java.util.Deque;
 import java.util.EnumSet;
+import java.util.HashSet;
 import java.util.Iterator;
 import java.util.LinkedHashSet;
-import java.util.LinkedList;
 import java.util.List;
 import java.util.Map;
 import java.util.Random;
 import java.util.Set;
 import java.util.concurrent.Callable;
+
+import com.mtbs3d.minecrift.settings.VRSettings;
 import net.minecraft.block.Block;
 import net.minecraft.block.BlockChest;
 import net.minecraft.block.BlockEnderChest;
@@ -28,6 +34,7 @@
 import net.minecraft.client.audio.PositionedSoundRecord;
 import net.minecraft.client.entity.EntityPlayerSP;
 import net.minecraft.client.gui.FontRenderer;
+import net.minecraft.client.model.ModelBase;
 import net.minecraft.client.multiplayer.WorldClient;
 import net.minecraft.client.particle.EntityFX;
 import net.minecraft.client.renderer.chunk.ChunkRenderDispatcher;
@@ -42,6 +49,7 @@
 import net.minecraft.client.renderer.culling.Frustrum;
 import net.minecraft.client.renderer.culling.ICamera;
 import net.minecraft.client.renderer.entity.RenderManager;
+import net.minecraft.client.renderer.entity.RenderPlayer;
 import net.minecraft.client.renderer.texture.TextureAtlasSprite;
 import net.minecraft.client.renderer.texture.TextureManager;
 import net.minecraft.client.renderer.texture.TextureMap;
@@ -67,6 +75,8 @@
 import net.minecraft.item.Item;
 import net.minecraft.item.ItemDye;
 import net.minecraft.item.ItemRecord;
+import net.minecraft.src.ChunkUtils;
+import net.minecraft.src.CloudRenderer;
 import net.minecraft.src.Config;
 import net.minecraft.src.CustomColorizer;
 import net.minecraft.src.CustomSky;
@@ -80,7 +90,6 @@
 import net.minecraft.tileentity.TileEntitySign;
 import net.minecraft.util.AxisAlignedBB;
 import net.minecraft.util.BlockPos;
-import net.minecraft.util.ClassInheratanceMultiMap;
 import net.minecraft.util.EnumFacing;
 import net.minecraft.util.EnumParticleTypes;
 import net.minecraft.util.EnumWorldBlockLayer;
@@ -188,20 +197,20 @@
     private double prevRenderSortZ;
     public boolean displayListEntitiesDirty = true;
     private static final String __OBFID = "CL_00000954";
-    private int glListClouds = -1;
-    private boolean isFancyGlListClouds = false;
-    private int cloudTickCounterGlList = -99999;
-    private double cloudPlayerX = 0.0D;
-    private double cloudPlayerY = 0.0D;
-    private double cloudPlayerZ = 0.0D;
+    private CloudRenderer cloudRenderer;
     public Entity renderedEntity;
     public Set chunksToResortTransparency = new LinkedHashSet();
     public Set chunksToUpdateForced = new LinkedHashSet();
-    private static final String __OBFID = "CL_00000954";
+    private Deque visibilityDeque = new ArrayDeque();
+    private List renderInfosEntities = new ArrayList(1024);
+    private List renderInfosTileEntities = new ArrayList(1024);
+    private int renderDistance = 0;
+    private int renderDistanceSq = 0;
+    private static final Set SET_ALL_FACINGS = Collections.unmodifiableSet(new HashSet(Arrays.asList(EnumFacing.VALUES)));
 
     public RenderGlobal(Minecraft mcIn)
     {
-        this.glListClouds = GLAllocation.generateDisplayLists(1);
+        this.cloudRenderer = new CloudRenderer(mcIn);
         this.mc = mcIn;
         this.field_175010_j = mcIn.getRenderManager();
         this.renderEngine = mcIn.getTextureManager();
@@ -517,6 +526,8 @@
             Blocks.leaves2.setGraphicsLevel(Config.isTreesFancy());
             BlockModelRenderer.updateAoLightValue();
             this.renderDistanceChunks = this.mc.gameSettings.renderDistanceChunks;
+            this.renderDistance = this.renderDistanceChunks * 16;
+            this.renderDistanceSq = this.renderDistance * this.renderDistance;
             boolean var1 = this.field_175005_X;
             this.field_175005_X = OpenGlHelper.func_176075_f();
 
@@ -584,8 +595,20 @@
 
     public void func_180446_a(Entity p_180446_1_, ICamera p_180446_2_, float partialTicks)
     {
+        int pass = 0;
+
+        if (Reflector.MinecraftForgeClient_getRenderPass.exists())
+        {
+            pass = Reflector.callInt(Reflector.MinecraftForgeClient_getRenderPass, new Object[0]);
+        }
+
         if (this.renderEntitiesStartupCounter > 0)
         {
+            if (pass > 0)
+            {
+                return;
+            }
+
             --this.renderEntitiesStartupCounter;
         }
         else
@@ -596,9 +619,14 @@
             this.theWorld.theProfiler.startSection("prepare");
             TileEntityRendererDispatcher.instance.func_178470_a(this.theWorld, this.mc.getTextureManager(), this.mc.fontRendererObj, this.mc.func_175606_aa(), partialTicks);
             this.field_175010_j.func_180597_a(this.theWorld, this.mc.fontRendererObj, this.mc.func_175606_aa(), this.mc.pointedEntity, this.mc.gameSettings, partialTicks);
-            this.countEntitiesTotal = 0;
-            this.countEntitiesRendered = 0;
-            this.countEntitiesHidden = 0;
+
+            if (pass == 0)
+            {
+                this.countEntitiesTotal = 0;
+                this.countEntitiesRendered = 0;
+                this.countEntitiesHidden = 0;
+            }
+
             Entity var10 = this.mc.func_175606_aa();
             double var11 = var10.lastTickPosX + (var10.posX - var10.lastTickPosX) * (double)partialTicks;
             double var13 = var10.lastTickPosY + (var10.posY - var10.lastTickPosY) * (double)partialTicks;
@@ -610,24 +638,34 @@
             this.mc.entityRenderer.func_180436_i();
             this.theWorld.theProfiler.endStartSection("global");
             List var17 = this.theWorld.getLoadedEntityList();
-            this.countEntitiesTotal = var17.size();
+
+            if (pass == 0)
+            {
+                this.countEntitiesTotal = var17.size();
+            }
 
             if (Config.isFogOff() && this.mc.entityRenderer.fogStandard)
             {
                 GlStateManager.disableFog();
             }
 
+            boolean forgeEntityPass = Reflector.ForgeEntity_shouldRenderInPass.exists();
+            boolean forgeTileEntityPass = Reflector.ForgeTileEntity_shouldRenderInPass.exists();
             int var18;
             Entity var19;
 
             for (var18 = 0; var18 < this.theWorld.weatherEffects.size(); ++var18)
             {
                 var19 = (Entity)this.theWorld.weatherEffects.get(var18);
-                ++this.countEntitiesRendered;
 
-                if (var19.isInRangeToRender3d(var4, var6, var8))
+                if (!forgeEntityPass || Reflector.callBoolean(var19, Reflector.ForgeEntity_shouldRenderInPass, new Object[] {Integer.valueOf(pass)}))
                 {
-                    this.field_175010_j.renderEntitySimple(var19, partialTicks);
+                    ++this.countEntitiesRendered;
+
+                    if (var19.isInRangeToRender3d(var4, var6, var8))
+                    {
+                        this.field_175010_j.renderEntitySimple(var19, partialTicks);
+                    }
                 }
             }
 
@@ -644,12 +682,16 @@
                 for (var18 = 0; var18 < var17.size(); ++var18)
                 {
                     var19 = (Entity)var17.get(var18);
-                    boolean var27 = this.mc.func_175606_aa() instanceof EntityLivingBase && ((EntityLivingBase)this.mc.func_175606_aa()).isPlayerSleeping();
-                    boolean var29 = var19.isInRangeToRender3d(var4, var6, var8) && (var19.ignoreFrustumCheck || p_180446_2_.isBoundingBoxInFrustum(var19.getEntityBoundingBox()) || var19.riddenByEntity == this.mc.thePlayer) && var19 instanceof EntityPlayer;
 
-                    if ((var19 != this.mc.func_175606_aa() || this.mc.gameSettings.thirdPersonView != 0 || var27) && var29)
+                    if (!forgeEntityPass || Reflector.callBoolean(var19, Reflector.ForgeEntity_shouldRenderInPass, new Object[] {Integer.valueOf(pass)}))
                     {
-                        this.field_175010_j.renderEntitySimple(var19, partialTicks);
+                        boolean var27 = this.mc.func_175606_aa() instanceof EntityLivingBase && ((EntityLivingBase)this.mc.func_175606_aa()).isPlayerSleeping();
+                        boolean var29 = var19.isInRangeToRender3d(var4, var6, var8) && (var19.ignoreFrustumCheck || p_180446_2_.isBoundingBoxInFrustum(var19.getEntityBoundingBox()) || var19.riddenByEntity == this.mc.thePlayer) && var19 instanceof EntityPlayer;
+
+                        if ((var19 != this.mc.func_175606_aa() || this.mc.gameSettings.thirdPersonView != 0 || var27) && var29)
+                        {
+                            this.field_175010_j.renderEntitySimple(var19, partialTicks);
+                        }
                     }
                 }
 
@@ -669,137 +711,230 @@
             }
 
             this.theWorld.theProfiler.endStartSection("entities");
-            Iterator var36 = this.glRenderLists.iterator();
+            Iterator var391 = this.renderInfosEntities.iterator();
             boolean oldFancyGraphics = this.mc.gameSettings.fancyGraphics;
             this.mc.gameSettings.fancyGraphics = Config.isDroppedItemsFancy();
-            RenderGlobal.ContainerLocalRenderInformation var371;
-
-            while (var36.hasNext())
+            RenderGlobal.ContainerLocalRenderInformation var40;
+            /** MINECRIFT */
+			Entity thePlayer = null;
+            RenderPlayer renderPlayer = (RenderPlayer)this.mc.getRenderManager().getEntityRenderObject(this.mc.thePlayer);
+            /** END MINECRIFT */
+            while (var391.hasNext())
             {
-                var371 = (RenderGlobal.ContainerLocalRenderInformation)var36.next();
-                Chunk fontRenderer = this.theWorld.getChunkFromBlockCoords(var371.field_178036_a.func_178568_j());
-                ClassInheratanceMultiMap var37 = fontRenderer.getEntityLists()[var371.field_178036_a.func_178568_j().getY() / 16];
-                Object var28 = Iterators.emptyIterator();
+                var40 = (RenderGlobal.ContainerLocalRenderInformation)var391.next();
+                Chunk fontRenderer = this.theWorld.getChunkFromBlockCoords(var40.field_178036_a.func_178568_j());
+                Iterator var37 = fontRenderer.getEntityLists()[var40.field_178036_a.func_178568_j().getY() / 16].iterator();
 
-                if (var37.size() > 0)
+                while (var37.hasNext())
                 {
-                    var28 = var37.iterator();
-                }
+                    Entity var28 = (Entity)var37.next();
 
-                while (((Iterator)var28).hasNext())
-                {
-                    Entity var31 = (Entity)((Iterator)var28).next();
-                    boolean var35 = this.field_175010_j.func_178635_a(var31, p_180446_2_, var4, var6, var8) || var31.riddenByEntity == this.mc.thePlayer;
-
-                    if (var35)
+                    if (!forgeEntityPass || Reflector.callBoolean(var28, Reflector.ForgeEntity_shouldRenderInPass, new Object[] {Integer.valueOf(pass)}))
                     {
-                        boolean var39 = this.mc.func_175606_aa() instanceof EntityLivingBase ? ((EntityLivingBase)this.mc.func_175606_aa()).isPlayerSleeping() : false;
+                        boolean var31 = this.field_175010_j.func_178635_a(var28, p_180446_2_, var4, var6, var8) || var28.riddenByEntity == this.mc.thePlayer;
 
-                        if (var31 == this.mc.func_175606_aa() && this.mc.gameSettings.thirdPersonView == 0 && !var39 || var31.posY >= 0.0D && var31.posY < 256.0D && !this.theWorld.isBlockLoaded(new BlockPos(var31)))
+                        if (var31)
                         {
-                            continue;
-                        }
+                            boolean var35 = this.mc.func_175606_aa() instanceof EntityLivingBase ? ((EntityLivingBase)this.mc.func_175606_aa()).isPlayerSleeping() : false;
 
-                        ++this.countEntitiesRendered;
+                            if (var28 == this.mc.func_175606_aa() && this.mc.gameSettings.thirdPersonView == 0 && !var35 || var28.posY >= 0.0D && var28.posY < 256.0D && !this.theWorld.isBlockLoaded(new BlockPos(var28)))
+                            {
+	                            /** MINECRIFT */
+	                            boolean skipRender = true;
 
-                        if (var31.getClass() == EntityItemFrame.class)
-                        {
-                            var31.renderDistanceWeight = 0.06D;
-                        }
+								if (this.mc.vrSettings.renderFullFirstPersonModelMode == VRSettings.RENDER_FIRST_PERSON_FULL)
+	                                skipRender = false;
 
-                        this.renderedEntity = var31;
-                        this.field_175010_j.renderEntitySimple(var31, partialTicks);
-                        this.renderedEntity = null;
-                    }
+	                            if (skipRender)
+	                                continue;
 
-                    if (!var35 && var31 instanceof EntityWitherSkull)
-                    {
-                        this.mc.getRenderManager().func_178630_b(var31, partialTicks);
+	                            thePlayer = var28;
+								/** END MINECRIFT */
+	                        }
+
+							/** MINECRIFT */
+	                        //++this.countEntitiesRendered;
+	                        /** END MINECRIFT */
+	                        if (var28.getClass() == EntityItemFrame.class)
+	                        {
+	                            var28.renderDistanceWeight = 0.06D;
+	                        }
+	                        /** MINECRIFT */
+	                        if (var28 != thePlayer) // EXPERIMENTAL: Delay player render - see end of this function
+	                        {
+	                            ++this.countEntitiesRendered;
+	                            this.renderedEntity = var28;
+	                            this.field_175010_j.renderEntitySimple(var28, partialTicks);
+	                            this.renderedEntity = null;
+	                        }
+	                        /** END MINECRIFT */
+	                    }
+
+	                    if (!var31 && var28 instanceof EntityWitherSkull)
+	                    {
+	                        this.mc.getRenderManager().func_178630_b(var28, partialTicks);
+	                    }
                     }
                 }
             }
 
             this.mc.gameSettings.fancyGraphics = oldFancyGraphics;
-            FontRenderer var38 = TileEntityRendererDispatcher.instance.getFontRenderer();
+            FontRenderer var41 = TileEntityRendererDispatcher.instance.getFontRenderer();
             this.theWorld.theProfiler.endStartSection("blockentities");
             RenderHelper.enableStandardItemLighting();
-            var36 = this.glRenderLists.iterator();
-            TileEntity var391;
+            var391 = this.renderInfosTileEntities.iterator();
+            TileEntity var42;
 
-            while (var36.hasNext())
+            while (var391.hasNext())
             {
-                var371 = (RenderGlobal.ContainerLocalRenderInformation)var36.next();
-                List var40 = var371.field_178036_a.func_178571_g().func_178485_b();
-                Object var42 = Iterators.emptyIterator();
+                var40 = (RenderGlobal.ContainerLocalRenderInformation)var391.next();
+                Iterator var43 = var40.field_178036_a.func_178571_g().func_178485_b().iterator();
 
-                if (var40.size() > 0)
+                while (var43.hasNext())
                 {
-                    var42 = var40.iterator();
-                }
+                    var42 = (TileEntity)var43.next();
 
-                while (((Iterator)var42).hasNext())
-                {
-                    var391 = (TileEntity)((Iterator)var42).next();
-                    TileEntityRendererDispatcher.instance.func_180546_a(var391, partialTicks, -1);
+                    if (forgeTileEntityPass)
+                    {
+                        if (!Reflector.callBoolean(var42, Reflector.ForgeTileEntity_shouldRenderInPass, new Object[] {Integer.valueOf(pass)}))
+                        {
+                            continue;
+                        }
+                        AxisAlignedBB var45 = (AxisAlignedBB)Reflector.call(var42, Reflector.ForgeTileEntity_getRenderBoundingBox, new Object[0]);
+
+                        if (var45 != null && !p_180446_2_.isBoundingBoxInFrustum(var45))
+                        {
+                            continue;
+                        }
+                    }
+
+                    TileEntityRendererDispatcher.instance.func_180546_a(var42, partialTicks, -1);
                 }
             }
 
-            Set var41 = this.n;
-            Set var43 = this.n;
-            TileEntity var47;
+            Set var44 = this.n;
+            Set var46 = this.n;
 
             synchronized (this.n)
             {
-                for (Iterator var45 = this.n.iterator(); var45.hasNext(); TileEntityRendererDispatcher.instance.func_180546_a(var47, partialTicks, -1))
+                Iterator var48 = this.n.iterator();
+
+                while (var48.hasNext())
                 {
-                    var47 = (TileEntity)var45.next();
-                    Class teClass = var47.getClass();
+                    TileEntity var39 = (TileEntity)var48.next();
 
-                    if (teClass == TileEntitySign.class && !Config.zoomMode)
+                    if (forgeTileEntityPass)
                     {
-                        EntityPlayerSP pl = this.mc.thePlayer;
-                        double distSq = var47.getDistanceSq(pl.posX, pl.posY, pl.posZ);
+                        if (!Reflector.callBoolean(var39, Reflector.ForgeTileEntity_shouldRenderInPass, new Object[] {Integer.valueOf(pass)}))
+                        {
+                            continue;
+                        }
+                        AxisAlignedBB shouldRender = (AxisAlignedBB)Reflector.call(var39, Reflector.ForgeTileEntity_getRenderBoundingBox, new Object[0]);
+
+                        if (shouldRender != null && !p_180446_2_.isBoundingBoxInFrustum(shouldRender))
+                        {
+                            continue;
+                        }
+                    }
+
+                    Class tileEntity = var39.getClass();
+
+                    if (tileEntity == TileEntitySign.class && !Config.zoomMode)
+                    {
+                        EntityPlayerSP aabb = this.mc.thePlayer;
+                        double distSq = var39.getDistanceSq(aabb.posX, aabb.posY, aabb.posZ);
 
                         if (distSq > 256.0D)
                         {
-                            var38.enabled = false;
+                            var41.enabled = false;
                         }
                     }
+
+                    TileEntityRendererDispatcher.instance.func_180546_a(var39, partialTicks, -1);
                 }
             }
 
             this.func_180443_s();
-            var36 = this.damagedBlocks.values().iterator();
+            var391 = this.damagedBlocks.values().iterator();
 
-            while (var36.hasNext())
+            while (var391.hasNext())
             {
-                DestroyBlockProgress var44 = (DestroyBlockProgress)var36.next();
-                BlockPos var46 = var44.func_180246_b();
-                var391 = this.theWorld.getTileEntity(var46);
+                DestroyBlockProgress var47 = (DestroyBlockProgress)var391.next();
+                BlockPos var49 = var47.func_180246_b();
+                var42 = this.theWorld.getTileEntity(var49);
 
-                if (var391 instanceof TileEntityChest)
+                if (var42 instanceof TileEntityChest)
                 {
-                    TileEntityChest var48 = (TileEntityChest)var391;
+                    TileEntityChest var50 = (TileEntityChest)var42;
 
-                    if (var48.adjacentChestXNeg != null)
+                    if (var50.adjacentChestXNeg != null)
                     {
-                        var46 = var46.offset(EnumFacing.WEST);
-                        var391 = this.theWorld.getTileEntity(var46);
+                        var49 = var49.offset(EnumFacing.WEST);
+                        var42 = this.theWorld.getTileEntity(var49);
                     }
-                    else if (var48.adjacentChestZNeg != null)
+                    else if (var50.adjacentChestZNeg != null)
                     {
-                        var46 = var46.offset(EnumFacing.NORTH);
-                        var391 = this.theWorld.getTileEntity(var46);
+                        var49 = var49.offset(EnumFacing.NORTH);
+                        var42 = this.theWorld.getTileEntity(var49);
                     }
                 }
 
-                Block var49 = this.theWorld.getBlockState(var46).getBlock();
+                Block var51 = this.theWorld.getBlockState(var49).getBlock();
+                boolean var52;
 
-                if (var391 != null && (var49 instanceof BlockChest || var49 instanceof BlockEnderChest || var49 instanceof BlockSign || var49 instanceof BlockSkull))
+                if (forgeTileEntityPass)
                 {
-                    TileEntityRendererDispatcher.instance.func_180546_a(var391, partialTicks, var44.getPartialBlockDamage());
+                    var52 = false;
+
+                    if (var42 != null && Reflector.callBoolean(var42, Reflector.ForgeTileEntity_shouldRenderInPass, new Object[] {Integer.valueOf(pass)}) && Reflector.callBoolean(var42, Reflector.ForgeTileEntity_canRenderBreaking, new Object[0]))
+                    {
+                        AxisAlignedBB var53 = (AxisAlignedBB)Reflector.call(var42, Reflector.ForgeTileEntity_getRenderBoundingBox, new Object[0]);
+
+                        if (var53 != null)
+                        {
+                            var52 = p_180446_2_.isBoundingBoxInFrustum(var53);
+                        }
+                    }
                 }
+                else
+                {
+                    var52 = var42 != null && (var51 instanceof BlockChest || var51 instanceof BlockEnderChest || var51 instanceof BlockSign || var51 instanceof BlockSkull);
+                }
+
+                if (var52)
+                {
+                    TileEntityRendererDispatcher.instance.func_180546_a(var42, partialTicks, var47.getPartialBlockDamage());
+                }
+            }					
+
+            /** MINECRIFT EXPERIMENTAL */
+            //OpenGLdebugging.dumpOpenGLstateToFileOnce("../Avatar.txt");
+            GlStateManager.blendFunc(GL11.GL_SRC_ALPHA, GL11.GL_ONE_MINUS_SRC_ALPHA);
+
+			// Render crosshair...
+            this.mc.entityRenderer.func_175072_h(); // Disable lightmap
+            this.mc.entityRenderer.renderCrosshairAtDepth();
+            this.mc.entityRenderer.func_180436_i(); // Enable lightmap
+
+            // ...and now render the player
+            if (thePlayer != null) 
+            {
+                ModelBase.vrMode = true;
+                ModelBase.vrOffset = this.mc.vrSettings.renderPlayerOffset;
+                ModelBase._renderHead = false;
+                ModelBase._renderHeadWear = this.mc.vrSettings.renderHeadWear;
+
+                ++this.countEntitiesRendered;
+                this.renderedEntity = thePlayer;
+                this.field_175010_j.renderEntitySimple(thePlayer, partialTicks);
+                this.renderedEntity = null;
+
+                ModelBase.vrMode = false;
+                ModelBase.vrOffset = 0f;
+                ModelBase._renderHead = true;
+                ModelBase._renderHeadWear = true;
             }
+			/** END MINECRIFT EXPERIMENTAL */
 
             this.func_174969_t();
             this.mc.entityRenderer.func_175072_h();
@@ -893,24 +1028,28 @@
         if (!var22 && this.displayListEntitiesDirty)
         {
             this.displayListEntitiesDirty = false;
-            this.glRenderLists = Lists.newArrayList();
-            LinkedList var36 = Lists.newLinkedList();
+            this.glRenderLists.clear();
+            this.renderInfosEntities.clear();
+            this.renderInfosTileEntities.clear();
+            this.visibilityDeque.clear();
+            Deque var36 = this.visibilityDeque;
             boolean var37 = this.mc.field_175612_E;
+            int var30;
 
             if (var20 == null)
             {
-                int var43 = var351.getY() > 0 ? 248 : 8;
+                int var46 = var351.getY() > 0 ? 248 : 8;
 
-                for (int var45 = -this.renderDistanceChunks; var45 <= this.renderDistanceChunks; ++var45)
+                for (var30 = -this.renderDistanceChunks; var30 <= this.renderDistanceChunks; ++var30)
                 {
-                    for (int var46 = -this.renderDistanceChunks; var46 <= this.renderDistanceChunks; ++var46)
+                    for (int var43 = -this.renderDistanceChunks; var43 <= this.renderDistanceChunks; ++var43)
                     {
-                        RenderChunk var30 = this.field_175008_n.func_178161_a(new BlockPos((var45 << 4) + 8, var43, (var46 << 4) + 8));
+                        RenderChunk var45 = this.field_175008_n.func_178161_a(new BlockPos((var30 << 4) + 8, var46, (var43 << 4) + 8));
 
-                        if (var30 != null && ((ICamera)camera).isBoundingBoxInFrustum(var30.field_178591_c))
+                        if (var45 != null && ((ICamera)camera).isBoundingBoxInFrustum(var45.field_178591_c))
                         {
-                            var30.func_178577_a(frameCount);
-                            var36.add(new RenderGlobal.ContainerLocalRenderInformation(var30, (EnumFacing)null, 0, (Object)null));
+                            var45.func_178577_a(frameCount);
+                            var36.add(new RenderGlobal.ContainerLocalRenderInformation(var45, (EnumFacing)null, 0, (Object)null));
                         }
                     }
                 }
@@ -919,16 +1058,16 @@
             {
                 boolean var38 = false;
                 RenderGlobal.ContainerLocalRenderInformation var40 = new RenderGlobal.ContainerLocalRenderInformation(var20, (EnumFacing)null, 0, (Object)null);
-                Set var42 = this.func_174978_c(var351);
+                Set var411 = SET_ALL_FACINGS;
 
-                if (!var42.isEmpty() && var42.size() == 1)
+                if (!var411.isEmpty() && var411.size() == 1)
                 {
-                    Vector3f var44 = this.a(viewEntity, partialTicks);
-                    EnumFacing var31 = EnumFacing.func_176737_a(var44.x, var44.y, var44.z).getOpposite();
-                    var42.remove(var31);
+                    Vector3f var431 = this.a(viewEntity, partialTicks);
+                    EnumFacing var31 = EnumFacing.func_176737_a(var431.x, var431.y, var431.z).getOpposite();
+                    var411.remove(var31);
                 }
 
-                if (var42.isEmpty())
+                if (var411.isEmpty())
                 {
                     var38 = true;
                 }
@@ -949,27 +1088,46 @@
                 }
             }
 
+            EnumFacing[] var391 = EnumFacing.VALUES;
+            var30 = var391.length;
+
             while (!var36.isEmpty())
             {
                 var39 = (RenderGlobal.ContainerLocalRenderInformation)var36.poll();
                 var41 = var39.field_178036_a;
-                EnumFacing var391 = var39.field_178034_b;
-                BlockPos var411 = var41.func_178568_j();
-                this.glRenderLists.add(var39);
-                EnumFacing[] var431 = EnumFacing.VALUES;
-                int var451 = var431.length;
-
-                for (int var461 = 0; var461 < var451; ++var461)
-                {
-                    EnumFacing var32 = var431[var461];
-                    RenderChunk var33 = this.getRenderChunkOffset(var351, var41, var32);
-
-                    if ((!var37 || !var39.field_178035_c.contains(var32.getOpposite())) && (!var37 || var391 == null || var41.func_178571_g().func_178495_a(var391.getOpposite(), var32)) && var33 != null && var33.func_178577_a(frameCount) && ((ICamera)camera).isBoundingBoxInFrustum(var33.field_178591_c))
-                    {
-                        RenderGlobal.ContainerLocalRenderInformation var34 = new RenderGlobal.ContainerLocalRenderInformation(var33, var32, var39.field_178032_d + 1, (Object)null);
-                        var34.field_178035_c.addAll(var39.field_178035_c);
-                        var34.field_178035_c.add(var32);
-                        var36.add(var34);
+                EnumFacing var42 = var39.field_178034_b;
+                BlockPos var44 = var41.func_178568_j();
+
+                if (!var41.field_178590_b.func_178489_a() || var41.func_178569_m())
+                {
+                    this.glRenderLists.add(var39);
+                }
+
+                if (ChunkUtils.hasEntities(this.theWorld.getChunkFromBlockCoords(var44)))
+                {
+                    this.renderInfosEntities.add(var39);
+                }
+
+                if (var41.func_178571_g().func_178485_b().size() > 0)
+                {
+                    this.renderInfosTileEntities.add(var39);
+                }
+
+                for (int var451 = 0; var451 < var30; ++var451)
+                {
+                    EnumFacing var32 = var391[var451];
+
+                    if ((!var37 || !var39.field_178035_c.contains(var32.getOpposite())) && (!var37 || var42 == null || var41.func_178571_g().func_178495_a(var42.getOpposite(), var32)))
+                    {
+                        RenderChunk var33 = this.getRenderChunkOffset(var351, var41, var32);
+
+                        if (var33 != null && var33.func_178577_a(frameCount) && ((ICamera)camera).isBoundingBoxInFrustum(var33.field_178591_c))
+                        {
+                            RenderGlobal.ContainerLocalRenderInformation var34 = new RenderGlobal.ContainerLocalRenderInformation(var33, var32, var39.field_178032_d + 1, (Object)null);
+                            var34.field_178035_c.addAll(var39.field_178035_c);
+                            var34.field_178035_c.add(var32);
+                            var36.add(var34);
+                        }
                     }
                 }
             }
@@ -1051,7 +1209,35 @@
     private RenderChunk getRenderChunkOffset(BlockPos p_174973_1_, RenderChunk renderChunk, EnumFacing p_174973_3_)
     {
         BlockPos var4 = renderChunk.getPositionOffset16(p_174973_3_);
-        return MathHelper.abs_int(p_174973_1_.getX() - var4.getX()) > this.renderDistanceChunks * 16 ? null : (var4.getY() >= 0 && var4.getY() < 256 ? (MathHelper.abs_int(p_174973_1_.getZ() - var4.getZ()) > this.renderDistanceChunks * 16 ? null : this.field_175008_n.func_178161_a(var4)) : null);
+
+        if (var4.getY() >= 0 && var4.getY() < 256)
+        {
+            int dx = MathHelper.abs_int(p_174973_1_.getX() - var4.getX());
+            int dz = MathHelper.abs_int(p_174973_1_.getZ() - var4.getZ());
+
+            if (Config.isFogOff())
+            {
+                if (dx > this.renderDistance || dz > this.renderDistance)
+                {
+                    return null;
+                }
+            }
+            else
+            {
+                int distSq = dx * dx + dz * dz;
+
+                if (distSq > this.renderDistanceSq)
+                {
+                    return null;
+                }
+            }
+
+            return this.field_175008_n.func_178161_a(var4);
+        }
+        else
+        {
+            return null;
+        }
     }
 
     private void func_174984_a(double p_174984_1_, double p_174984_3_, double p_174984_5_)
@@ -1589,7 +1775,7 @@
                 }
                 else
                 {
-                    float partialTicks1 = p_180447_1_;
+                    this.cloudRenderer.prepareToRender(false, this.cloudTickCounter, p_180447_1_);
                     p_180447_1_ = 0.0F;
                     GlStateManager.disableCull();
                     float var31 = (float)(this.mc.func_175606_aa().lastTickPosY + (this.mc.func_175606_aa().posY - this.mc.func_175606_aa().lastTickPosY) * (double)p_180447_1_);
@@ -1600,42 +1786,40 @@
                     this.renderEngine.bindTexture(locationCloudsPng);
                     GlStateManager.enableBlend();
                     GlStateManager.tryBlendFuncSeparate(770, 771, 1, 0);
-                    double dc;
-                    double exactPlayerZ1;
 
-                    if (this.isFancyGlListClouds || this.cloudTickCounter >= this.cloudTickCounterGlList + 20)
+                    if (this.cloudRenderer.shouldUpdateGlList())
                     {
-                        GL11.glNewList(this.glListClouds, GL11.GL_COMPILE);
-                        Vec3 entityliving = this.theWorld.getCloudColour(p_180447_1_);
-                        float exactPlayerX = (float)entityliving.xCoord;
-                        float var10 = (float)entityliving.yCoord;
-                        float exactPlayerY = (float)entityliving.zCoord;
+                        this.cloudRenderer.startUpdateGlList();
+                        Vec3 var8 = this.theWorld.getCloudColour(p_180447_1_);
+                        float var9 = (float)var8.xCoord;
+                        float var10 = (float)var8.yCoord;
+                        float var11 = (float)var8.zCoord;
                         float var12;
 
                         if (p_180447_2_ != 2)
                         {
-                            var12 = (exactPlayerX * 30.0F + var10 * 59.0F + exactPlayerY * 11.0F) / 100.0F;
-                            float exactPlayerZ = (exactPlayerX * 30.0F + var10 * 70.0F) / 100.0F;
-                            float var14 = (exactPlayerX * 30.0F + exactPlayerY * 70.0F) / 100.0F;
-                            exactPlayerX = var12;
-                            var10 = exactPlayerZ;
-                            exactPlayerY = var14;
+                            var12 = (var9 * 30.0F + var10 * 59.0F + var11 * 11.0F) / 100.0F;
+                            float var26 = (var9 * 30.0F + var10 * 70.0F) / 100.0F;
+                            float var14 = (var9 * 30.0F + var11 * 70.0F) / 100.0F;
+                            var9 = var12;
+                            var10 = var26;
+                            var11 = var14;
                         }
 
                         var12 = 4.8828125E-4F;
-                        exactPlayerZ1 = (double)((float)this.cloudTickCounter + p_180447_1_);
-                        dc = this.mc.func_175606_aa().prevPosX + (this.mc.func_175606_aa().posX - this.mc.func_175606_aa().prevPosX) * (double)p_180447_1_ + exactPlayerZ1 * 0.029999999329447746D;
-                        double cdx = this.mc.func_175606_aa().prevPosZ + (this.mc.func_175606_aa().posZ - this.mc.func_175606_aa().prevPosZ) * (double)p_180447_1_;
-                        int cdz = MathHelper.floor_double(dc / 2048.0D);
-                        int var20 = MathHelper.floor_double(cdx / 2048.0D);
-                        dc -= (double)(cdz * 2048);
-                        cdx -= (double)(var20 * 2048);
+                        double var261 = (double)((float)this.cloudTickCounter + p_180447_1_);
+                        double var15 = this.mc.func_175606_aa().prevPosX + (this.mc.func_175606_aa().posX - this.mc.func_175606_aa().prevPosX) * (double)p_180447_1_ + var261 * 0.029999999329447746D;
+                        double var17 = this.mc.func_175606_aa().prevPosZ + (this.mc.func_175606_aa().posZ - this.mc.func_175606_aa().prevPosZ) * (double)p_180447_1_;
+                        int var19 = MathHelper.floor_double(var15 / 2048.0D);
+                        int var20 = MathHelper.floor_double(var17 / 2048.0D);
+                        var15 -= (double)(var19 * 2048);
+                        var17 -= (double)(var20 * 2048);
                         float var21 = this.theWorld.provider.getCloudHeight() - var31 + 0.33F;
                         var21 += this.mc.gameSettings.ofCloudsHeight * 128.0F;
-                        float var22 = (float)(dc * 4.8828125E-4D);
-                        float var23 = (float)(cdx * 4.8828125E-4D);
+                        float var22 = (float)(var15 * 4.8828125E-4D);
+                        float var23 = (float)(var17 * 4.8828125E-4D);
                         var7.startDrawingQuads();
-                        var7.func_178960_a(exactPlayerX, var10, exactPlayerY, 0.8F);
+                        var7.func_178960_a(var9, var10, var11, 0.8F);
 
                         for (int var24 = -256; var24 < 256; var24 += 32)
                         {
@@ -1649,25 +1833,10 @@
                         }
 
                         var6.draw();
-                        GL11.glEndList();
-                        this.isFancyGlListClouds = false;
-                        this.cloudTickCounterGlList = this.cloudTickCounter;
-                        this.cloudPlayerX = this.mc.func_175606_aa().prevPosX;
-                        this.cloudPlayerY = this.mc.func_175606_aa().prevPosY;
-                        this.cloudPlayerZ = this.mc.func_175606_aa().prevPosZ;
-                    }
-
-                    Entity entityliving1 = this.mc.func_175606_aa();
-                    double exactPlayerX1 = entityliving1.prevPosX + (entityliving1.posX - entityliving1.prevPosX) * (double)partialTicks1;
-                    double exactPlayerY1 = entityliving1.prevPosY + (entityliving1.posY - entityliving1.prevPosY) * (double)partialTicks1;
-                    exactPlayerZ1 = entityliving1.prevPosZ + (entityliving1.posZ - entityliving1.prevPosZ) * (double)partialTicks1;
-                    dc = (double)((float)(this.cloudTickCounter - this.cloudTickCounterGlList) + partialTicks1);
-                    float cdx1 = (float)(exactPlayerX1 - this.cloudPlayerX + dc * 0.03D);
-                    float cdy = (float)(exactPlayerY1 - this.cloudPlayerY);
-                    float cdz1 = (float)(exactPlayerZ1 - this.cloudPlayerZ);
-                    GlStateManager.translate(-cdx1, -cdy, -cdz1);
-                    GlStateManager.callList(this.glListClouds);
-                    GlStateManager.translate(cdx1, cdy, cdz1);
+                        this.cloudRenderer.endUpdateGlList();
+                    }
+
+                    this.cloudRenderer.renderGlList();
                     GlStateManager.color(1.0F, 1.0F, 1.0F, 1.0F);
                     GlStateManager.disableBlend();
                     GlStateManager.enableCull();
@@ -1686,7 +1855,7 @@
 
     private void func_180445_c(float p_180445_1_, int p_180445_2_)
     {
-        float partialTicks = p_180445_1_;
+        this.cloudRenderer.prepareToRender(true, this.cloudTickCounter, p_180445_1_);
         p_180445_1_ = 0.0F;
         GlStateManager.disableCull();
         float var3 = (float)(this.mc.func_175606_aa().lastTickPosY + (this.mc.func_175606_aa().posY - this.mc.func_175606_aa().lastTickPosY) * (double)p_180445_1_);
@@ -1733,144 +1902,130 @@
         boolean var27 = true;
         float var28 = 9.765625E-4F;
         GlStateManager.scale(12.0F, 1.0F, 12.0F);
+        int var30;
 
-        for (int var29 = 0; var29 < 2; ++var29)
+        for (var30 = 0; var30 < 2; ++var30)
         {
-            if (var29 == 0)
+            if (var30 == 0)
             {
-                GL11.glColorMask(false, false, false, false);
+                GlStateManager.colorMask(false, false, false, false);
             }
             else
             {
                 switch (p_180445_2_)
                 {
                     case 0:
-                        GL11.glColorMask(false, true, true, true);
+                        GlStateManager.colorMask(false, true, true, true);
                         break;
 
                     case 1:
-                        GL11.glColorMask(true, false, false, true);
+                        GlStateManager.colorMask(true, false, false, true);
                         break;
 
                     case 2:
-                        GL11.glColorMask(true, true, true, true);
+                        GlStateManager.colorMask(true, true, true, true);
                 }
             }
 
-            if (!this.isFancyGlListClouds || this.cloudTickCounter >= this.cloudTickCounterGlList + 20)
-            {
-                GL11.glNewList(this.glListClouds, GL11.GL_COMPILE);
+            this.cloudRenderer.renderGlList();
+        }
+
+        if (this.cloudRenderer.shouldUpdateGlList())
+        {
+            this.cloudRenderer.startUpdateGlList();
 
-                for (int entityliving = -3; entityliving <= 4; ++entityliving)
+            for (var30 = -3; var30 <= 4; ++var30)
+            {
+                for (int var31 = -3; var31 <= 4; ++var31)
                 {
-                    for (int exactPlayerX = -3; exactPlayerX <= 4; ++exactPlayerX)
+                    var5.startDrawingQuads();
+                    float var32 = (float)(var30 * 8);
+                    float var33 = (float)(var31 * 8);
+                    float var34 = var32 - var24;
+                    float var35 = var33 - var25;
+
+                    if (var14 > -5.0F)
                     {
-                        var5.startDrawingQuads();
-                        float var32 = (float)(entityliving * 8);
-                        float exactPlayerY = (float)(exactPlayerX * 8);
-                        float var34 = var32 - var24;
-                        float exactPlayerZ = exactPlayerY - var25;
+                        var5.func_178960_a(var18 * 0.7F, var19 * 0.7F, var20 * 0.7F, 0.8F);
+                        var5.func_178980_d(0.0F, -1.0F, 0.0F);
+                        var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 0.0F), (double)(var35 + 8.0F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((var33 + 8.0F) * 0.00390625F + var23));
+                        var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 0.0F), (double)(var35 + 8.0F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((var33 + 8.0F) * 0.00390625F + var23));
+                        var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 0.0F), (double)(var35 + 0.0F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((var33 + 0.0F) * 0.00390625F + var23));
+                        var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 0.0F), (double)(var35 + 0.0F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((var33 + 0.0F) * 0.00390625F + var23));
+                    }
 
-                        if (var14 > -5.0F)
-                        {
-                            var5.func_178960_a(var18 * 0.7F, var19 * 0.7F, var20 * 0.7F, 0.8F);
-                            var5.func_178980_d(0.0F, -1.0F, 0.0F);
-                            var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 0.0F), (double)(exactPlayerZ + 8.0F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((exactPlayerY + 8.0F) * 0.00390625F + var23));
-                            var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 0.0F), (double)(exactPlayerZ + 8.0F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((exactPlayerY + 8.0F) * 0.00390625F + var23));
-                            var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 0.0F), (double)(exactPlayerZ + 0.0F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((exactPlayerY + 0.0F) * 0.00390625F + var23));
-                            var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 0.0F), (double)(exactPlayerZ + 0.0F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((exactPlayerY + 0.0F) * 0.00390625F + var23));
-                        }
+                    if (var14 <= 5.0F)
+                    {
+                        var5.func_178960_a(var18, var19, var20, 0.8F);
+                        var5.func_178980_d(0.0F, 1.0F, 0.0F);
+                        var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 4.0F - 9.765625E-4F), (double)(var35 + 8.0F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((var33 + 8.0F) * 0.00390625F + var23));
+                        var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 4.0F - 9.765625E-4F), (double)(var35 + 8.0F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((var33 + 8.0F) * 0.00390625F + var23));
+                        var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 4.0F - 9.765625E-4F), (double)(var35 + 0.0F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((var33 + 0.0F) * 0.00390625F + var23));
+                        var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 4.0F - 9.765625E-4F), (double)(var35 + 0.0F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((var33 + 0.0F) * 0.00390625F + var23));
+                    }
 
-                        if (var14 <= 5.0F)
-                        {
-                            var5.func_178960_a(var18, var19, var20, 0.8F);
-                            var5.func_178980_d(0.0F, 1.0F, 0.0F);
-                            var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 4.0F - 9.765625E-4F), (double)(exactPlayerZ + 8.0F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((exactPlayerY + 8.0F) * 0.00390625F + var23));
-                            var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 4.0F - 9.765625E-4F), (double)(exactPlayerZ + 8.0F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((exactPlayerY + 8.0F) * 0.00390625F + var23));
-                            var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 4.0F - 9.765625E-4F), (double)(exactPlayerZ + 0.0F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((exactPlayerY + 0.0F) * 0.00390625F + var23));
-                            var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 4.0F - 9.765625E-4F), (double)(exactPlayerZ + 0.0F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((exactPlayerY + 0.0F) * 0.00390625F + var23));
-                        }
+                    var5.func_178960_a(var18 * 0.9F, var19 * 0.9F, var20 * 0.9F, 0.8F);
+                    int var36;
 
-                        var5.func_178960_a(var18 * 0.9F, var19 * 0.9F, var20 * 0.9F, 0.8F);
-                        int var36;
+                    if (var30 > -1)
+                    {
+                        var5.func_178980_d(-1.0F, 0.0F, 0.0F);
 
-                        if (entityliving > -1)
+                        for (var36 = 0; var36 < 8; ++var36)
                         {
-                            var5.func_178980_d(-1.0F, 0.0F, 0.0F);
-
-                            for (var36 = 0; var36 < 8; ++var36)
-                            {
-                                var5.addVertexWithUV((double)(var34 + (float)var36 + 0.0F), (double)(var14 + 0.0F), (double)(exactPlayerZ + 8.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((exactPlayerY + 8.0F) * 0.00390625F + var23));
-                                var5.addVertexWithUV((double)(var34 + (float)var36 + 0.0F), (double)(var14 + 4.0F), (double)(exactPlayerZ + 8.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((exactPlayerY + 8.0F) * 0.00390625F + var23));
-                                var5.addVertexWithUV((double)(var34 + (float)var36 + 0.0F), (double)(var14 + 4.0F), (double)(exactPlayerZ + 0.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((exactPlayerY + 0.0F) * 0.00390625F + var23));
-                                var5.addVertexWithUV((double)(var34 + (float)var36 + 0.0F), (double)(var14 + 0.0F), (double)(exactPlayerZ + 0.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((exactPlayerY + 0.0F) * 0.00390625F + var23));
-                            }
+                            var5.addVertexWithUV((double)(var34 + (float)var36 + 0.0F), (double)(var14 + 0.0F), (double)(var35 + 8.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((var33 + 8.0F) * 0.00390625F + var23));
+                            var5.addVertexWithUV((double)(var34 + (float)var36 + 0.0F), (double)(var14 + 4.0F), (double)(var35 + 8.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((var33 + 8.0F) * 0.00390625F + var23));
+                            var5.addVertexWithUV((double)(var34 + (float)var36 + 0.0F), (double)(var14 + 4.0F), (double)(var35 + 0.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((var33 + 0.0F) * 0.00390625F + var23));
+                            var5.addVertexWithUV((double)(var34 + (float)var36 + 0.0F), (double)(var14 + 0.0F), (double)(var35 + 0.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((var33 + 0.0F) * 0.00390625F + var23));
                         }
+                    }
 
-                        if (entityliving <= 1)
-                        {
-                            var5.func_178980_d(1.0F, 0.0F, 0.0F);
+                    if (var30 <= 1)
+                    {
+                        var5.func_178980_d(1.0F, 0.0F, 0.0F);
 
-                            for (var36 = 0; var36 < 8; ++var36)
-                            {
-                                var5.addVertexWithUV((double)(var34 + (float)var36 + 1.0F - 9.765625E-4F), (double)(var14 + 0.0F), (double)(exactPlayerZ + 8.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((exactPlayerY + 8.0F) * 0.00390625F + var23));
-                                var5.addVertexWithUV((double)(var34 + (float)var36 + 1.0F - 9.765625E-4F), (double)(var14 + 4.0F), (double)(exactPlayerZ + 8.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((exactPlayerY + 8.0F) * 0.00390625F + var23));
-                                var5.addVertexWithUV((double)(var34 + (float)var36 + 1.0F - 9.765625E-4F), (double)(var14 + 4.0F), (double)(exactPlayerZ + 0.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((exactPlayerY + 0.0F) * 0.00390625F + var23));
-                                var5.addVertexWithUV((double)(var34 + (float)var36 + 1.0F - 9.765625E-4F), (double)(var14 + 0.0F), (double)(exactPlayerZ + 0.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((exactPlayerY + 0.0F) * 0.00390625F + var23));
-                            }
+                        for (var36 = 0; var36 < 8; ++var36)
+                        {
+                            var5.addVertexWithUV((double)(var34 + (float)var36 + 1.0F - 9.765625E-4F), (double)(var14 + 0.0F), (double)(var35 + 8.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((var33 + 8.0F) * 0.00390625F + var23));
+                            var5.addVertexWithUV((double)(var34 + (float)var36 + 1.0F - 9.765625E-4F), (double)(var14 + 4.0F), (double)(var35 + 8.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((var33 + 8.0F) * 0.00390625F + var23));
+                            var5.addVertexWithUV((double)(var34 + (float)var36 + 1.0F - 9.765625E-4F), (double)(var14 + 4.0F), (double)(var35 + 0.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((var33 + 0.0F) * 0.00390625F + var23));
+                            var5.addVertexWithUV((double)(var34 + (float)var36 + 1.0F - 9.765625E-4F), (double)(var14 + 0.0F), (double)(var35 + 0.0F), (double)((var32 + (float)var36 + 0.5F) * 0.00390625F + var22), (double)((var33 + 0.0F) * 0.00390625F + var23));
                         }
+                    }
 
-                        var5.func_178960_a(var18 * 0.8F, var19 * 0.8F, var20 * 0.8F, 0.8F);
+                    var5.func_178960_a(var18 * 0.8F, var19 * 0.8F, var20 * 0.8F, 0.8F);
 
-                        if (exactPlayerX > -1)
-                        {
-                            var5.func_178980_d(0.0F, 0.0F, -1.0F);
+                    if (var31 > -1)
+                    {
+                        var5.func_178980_d(0.0F, 0.0F, -1.0F);
 
-                            for (var36 = 0; var36 < 8; ++var36)
-                            {
-                                var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 4.0F), (double)(exactPlayerZ + (float)var36 + 0.0F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((exactPlayerY + (float)var36 + 0.5F) * 0.00390625F + var23));
-                                var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 4.0F), (double)(exactPlayerZ + (float)var36 + 0.0F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((exactPlayerY + (float)var36 + 0.5F) * 0.00390625F + var23));
-                                var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 0.0F), (double)(exactPlayerZ + (float)var36 + 0.0F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((exactPlayerY + (float)var36 + 0.5F) * 0.00390625F + var23));
-                                var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 0.0F), (double)(exactPlayerZ + (float)var36 + 0.0F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((exactPlayerY + (float)var36 + 0.5F) * 0.00390625F + var23));
-                            }
+                        for (var36 = 0; var36 < 8; ++var36)
+                        {
+                            var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 4.0F), (double)(var35 + (float)var36 + 0.0F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((var33 + (float)var36 + 0.5F) * 0.00390625F + var23));
+                            var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 4.0F), (double)(var35 + (float)var36 + 0.0F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((var33 + (float)var36 + 0.5F) * 0.00390625F + var23));
+                            var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 0.0F), (double)(var35 + (float)var36 + 0.0F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((var33 + (float)var36 + 0.5F) * 0.00390625F + var23));
+                            var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 0.0F), (double)(var35 + (float)var36 + 0.0F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((var33 + (float)var36 + 0.5F) * 0.00390625F + var23));
                         }
+                    }
 
-                        if (exactPlayerX <= 1)
-                        {
-                            var5.func_178980_d(0.0F, 0.0F, 1.0F);
+                    if (var31 <= 1)
+                    {
+                        var5.func_178980_d(0.0F, 0.0F, 1.0F);
 
-                            for (var36 = 0; var36 < 8; ++var36)
-                            {
-                                var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 4.0F), (double)(exactPlayerZ + (float)var36 + 1.0F - 9.765625E-4F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((exactPlayerY + (float)var36 + 0.5F) * 0.00390625F + var23));
-                                var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 4.0F), (double)(exactPlayerZ + (float)var36 + 1.0F - 9.765625E-4F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((exactPlayerY + (float)var36 + 0.5F) * 0.00390625F + var23));
-                                var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 0.0F), (double)(exactPlayerZ + (float)var36 + 1.0F - 9.765625E-4F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((exactPlayerY + (float)var36 + 0.5F) * 0.00390625F + var23));
-                                var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 0.0F), (double)(exactPlayerZ + (float)var36 + 1.0F - 9.765625E-4F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((exactPlayerY + (float)var36 + 0.5F) * 0.00390625F + var23));
-                            }
+                        for (var36 = 0; var36 < 8; ++var36)
+                        {
+                            var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 4.0F), (double)(var35 + (float)var36 + 1.0F - 9.765625E-4F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((var33 + (float)var36 + 0.5F) * 0.00390625F + var23));
+                            var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 4.0F), (double)(var35 + (float)var36 + 1.0F - 9.765625E-4F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((var33 + (float)var36 + 0.5F) * 0.00390625F + var23));
+                            var5.addVertexWithUV((double)(var34 + 8.0F), (double)(var14 + 0.0F), (double)(var35 + (float)var36 + 1.0F - 9.765625E-4F), (double)((var32 + 8.0F) * 0.00390625F + var22), (double)((var33 + (float)var36 + 0.5F) * 0.00390625F + var23));
+                            var5.addVertexWithUV((double)(var34 + 0.0F), (double)(var14 + 0.0F), (double)(var35 + (float)var36 + 1.0F - 9.765625E-4F), (double)((var32 + 0.0F) * 0.00390625F + var22), (double)((var33 + (float)var36 + 0.5F) * 0.00390625F + var23));
                         }
-
-                        var4.draw();
                     }
+
+                    var4.draw();
                 }
+            }
 
-                GL11.glEndList();
-                this.isFancyGlListClouds = true;
-                this.cloudTickCounterGlList = this.cloudTickCounter;
-                this.cloudPlayerX = this.mc.func_175606_aa().prevPosX;
-                this.cloudPlayerY = this.mc.func_175606_aa().prevPosY;
-                this.cloudPlayerZ = this.mc.func_175606_aa().prevPosZ;
-            }
-
-            Entity var43 = this.mc.func_175606_aa();
-            double var44 = var43.prevPosX + (var43.posX - var43.prevPosX) * (double)partialTicks;
-            double var45 = var43.prevPosY + (var43.posY - var43.prevPosY) * (double)partialTicks;
-            double var46 = var43.prevPosZ + (var43.posZ - var43.prevPosZ) * (double)partialTicks;
-            double dc = (double)((float)(this.cloudTickCounter - this.cloudTickCounterGlList) + partialTicks);
-            float cdx = (float)(var44 - this.cloudPlayerX + dc * 0.03D);
-            float cdy = (float)(var45 - this.cloudPlayerY);
-            float cdz = (float)(var46 - this.cloudPlayerZ);
-            GlStateManager.translate(-cdx / 12.0F, -cdy, -cdz / 12.0F);
-            GlStateManager.callList(this.glListClouds);
-            GlStateManager.translate(cdx / 12.0F, cdy, cdz / 12.0F);
+            this.cloudRenderer.endUpdateGlList();
         }
 
         GlStateManager.color(1.0F, 1.0F, 1.0F, 1.0F);
@@ -2119,8 +2274,30 @@
                 double var16 = (double)var13.getY() - var7;
                 double var18 = (double)var13.getZ() - var9;
                 Block var20 = this.theWorld.getBlockState(var13).getBlock();
+                boolean renderBreaking;
+
+                if (Reflector.ForgeTileEntity_canRenderBreaking.exists())
+                {
+                    boolean var22 = var20 instanceof BlockChest || var20 instanceof BlockEnderChest || var20 instanceof BlockSign || var20 instanceof BlockSkull;
+
+                    if (!var22)
+                    {
+                        TileEntity var23 = this.theWorld.getTileEntity(var13);
+
+                        if (var23 != null)
+                        {
+                            var22 = Reflector.callBoolean(var23, Reflector.ForgeTileEntity_canRenderBreaking, new Object[0]);
+                        }
+                    }
+
+                    renderBreaking = !var22;
+                }
+                else
+                {
+                    renderBreaking = !(var20 instanceof BlockChest) && !(var20 instanceof BlockEnderChest) && !(var20 instanceof BlockSign) && !(var20 instanceof BlockSkull);
+                }
 
-                if (!(var20 instanceof BlockChest) && !(var20 instanceof BlockEnderChest) && !(var20 instanceof BlockSign) && !(var20 instanceof BlockSkull))
+                if (renderBreaking)
                 {
                     if (var14 * var14 + var16 * var16 + var18 * var18 > 1024.0D)
                     {
@@ -2132,10 +2309,10 @@
 
                         if (var21.getBlock().getMaterial() != Material.air)
                         {
-                            int var22 = var12.getPartialBlockDamage();
-                            TextureAtlasSprite var23 = this.destroyBlockIcons[var22];
+                            int var221 = var12.getPartialBlockDamage();
+                            TextureAtlasSprite var231 = this.destroyBlockIcons[var221];
                             BlockRendererDispatcher var24 = this.mc.getBlockRendererDispatcher();
-                            var24.func_175020_a(var21, var13, var23, this.theWorld);
+                            var24.func_175020_a(var21, var13, var231, this.theWorld);
                         }
                     }
                 }
@@ -2330,15 +2507,10 @@
             var18.addCrashSectionCallable("Position", new Callable()
             {
                 private static final String __OBFID = "CL_00000955";
-                private static final String __OBFID = "CL_00000955";
                 public String call()
                 {
                     return CrashReportCategory.getCoordinateInfo(p_180442_3_, p_180442_5_, p_180442_7_);
                 }
-                public Object call() throws Exception
-                {
-                    return this.call();
-                }
             });
             throw new ReportedException(var17);
         }
@@ -2432,6 +2604,10 @@
             {
                 return null;
             }
+            else if (p_174974_1_ == EnumParticleTypes.FIREWORKS_SPARK.func_179348_c() && !Config.isFireworkParticles())
+            {
+                return null;
+            }
             else if (p_174974_2_)
             {
                 return this.mc.effectRenderer.func_178927_a(p_174974_1_, p_174974_3_, p_174974_5_, p_174974_7_, p_174974_9_, p_174974_11_, p_174974_13_, p_174974_15_);
@@ -2808,7 +2984,7 @@
 
     public void resetClouds()
     {
-        this.cloudTickCounterGlList = -9999;
+        this.cloudRenderer.reset();
     }
 
     class ContainerLocalRenderInformation
@@ -2818,7 +2994,6 @@
         final Set field_178035_c;
         final int field_178032_d;
         private static final String __OBFID = "CL_00002534";
-        private static final String __OBFID = "CL_00002534";
 
         private ContainerLocalRenderInformation(RenderChunk p_i46248_2_, EnumFacing p_i46248_3_, int p_i46248_4_)
         {
@@ -2838,7 +3013,6 @@
     {
         static final int[] field_178037_a = new int[VertexFormatElement.EnumUseage.values().length];
         private static final String __OBFID = "CL_00002535";
-        private static final String __OBFID = "CL_00002535";
 
         static
         {
